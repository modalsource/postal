- if @server
  - page_title << @server.name
- page_title << @domain.name
- page_title << "DNS Setup"


- if @server
  = render 'servers/sidebar', :active_server => @server
  = render 'servers/header', :active_nav => :domains
  = render 'nav', :active_nav => :domains
- else
  .pageHeader
    %h1.pageHeader__title
      %span.pageHeader__titlePrevious
        = @organization.name
        &rarr; Domains &rarr;
      = @domain.name
  = render 'organizations/nav', :active_nav => :domains

.pageContent.pageContent--compact
  %h2.pageContent__title DNS Setup for #{@domain.name}
  %p.pageContent__intro.u-margin
    Follow the instructions below to configure SPF & DKIM records for this domain.
    We highly recommend that you do this to ensure your messages are delivered
    correctly and quickly.

  .u-margin.buttonSet
    = link_to "Check my records are correct", [:check, organization, @server, @domain], :remote => true, :method => :post, :class => 'button'
    = link_to "Configure MTA-STS & TLS-RPT", [:edit_security, organization, @server, @domain], :class => 'button'
    = link_to "Back to domain list", [organization, @server, :domains], :class => 'button button--neutral'
  - if @domain.dns_checked_at
    %p.u-margin We last checked the validity of your DNS records #{distance_of_time_in_words_to_now @domain.dns_checked_at} ago.

  %h3.pageContent__subTitle SPF Record
  - if @domain.spf_status == 'OK'
    %p.pageContent__text.u-green.u-bold
      %span.label.label--green Good
      Your SPF record looks good!
  - elsif !@domain.spf_status.nil?
    %p.pageContent__text.u-orange.u-bold
      %span.label.label--orange Warning
      = @domain.spf_error

  %p.pageContent__text
    You need to add a TXT record at the apex/root of your domain (@) with the following
    content. If you already send mail from another service, you may just need to add
    <b>include:#{Postal::Config.dns.spf_include}</b> to your existing record.
  %pre.codeBlock.u-margin= @domain.spf_record

  %h3.pageContent__subTitle DKIM Record
  - if @domain.dkim_status == 'OK'
    %p.pageContent__text.u-green.u-bold
      %span.label.label--green Good
      Your DKIM record looks good!
  - elsif !@domain.dkim_status.nil?
    %p.pageContent__text.u-orange.u-bold
      %span.label.label--orange Warning
      = @domain.dkim_error

  %p.pageContent__text
    You need to add a new TXT record with the name <b>#{@domain.dkim_record_name}</b>
    with the following content.
  %pre.codeBlock.u-margin= @domain.dkim_record

  %h3.pageContent__subTitle Return Path
  - if @domain.return_path_status == 'OK'
    %p.pageContent__text.u-green.u-bold
      %span.label.label--green Good
      Your return path looks good. We'll use this when sending e-mail from this domain.
  - elsif @domain.return_path_status == 'Missing'
    %p.pageContent__text.u-grey.u-bold
      %span.label.label--grey OK
      There's no return path for this domain. This is OK but we recommend adding the record to improve deliverability and achieve DMARC alignment.
  - elsif !@domain.return_path_status.nil?
    %p.pageContent__text.u-orange.u-bold
      %span.label.label--orange Warning
      = @domain.return_path_error

  %p.pageContent__text
    This is optional but we recommend adding this to improve deliverability. You should add
    a <b>CNAME</b> record at <b>#{@domain.return_path_domain}</b> to point to the hostname below.
  %pre.codeBlock.u-margin= Postal::Config.dns.return_path_domain


  - if Postal::Config.dns.dmarc_preferred_dns_entry.present?
    %h3.pageContent__subTitle DMARC Record
    - if @domain.dmarc_status == 'OK'
      %p.pageContent__text.u-green.u-bold
        %span.label.label--green Good
        Your DMARC record looks good!
    - elsif @domain.dmarc_status == 'Missing'
      %p.pageContent__text.u-grey.u-bold
        %span.label.label--grey Warning
        There's no DMARC record for this domain. This is optional but we recommend adding it to improve deliverability.
    - elsif !@domain.dmarc_status.nil?
      %p.pageContent__text.u-orange.u-bold
        %span.label.label--orange Warning
        = @domain.dmarc_error

    %p.pageContent__text
      This is optional but we recommend adding this to improve deliverability and protect your domain from spoofing.
      You should add a <b>TXT</b> record at <b>#{@domain.dmarc_record_name}</b> with the following content.
    %pre.codeBlock.u-margin= @domain.dmarc_record


  %h3.pageContent__subTitle MX Records
  - if @domain.mx_status == 'OK'
    %p.pageContent__text.u-green.u-bold
      %span.label.label--green Good
      Your MX records look like they're good to go!
  - elsif @domain.mx_status == 'Missing'
    %p.pageContent__text.u-grey.u-bold
      %span.label.label--grey OK
      None of the MX records for this domain point to us. Incoming mail won't be sent to us.
  - elsif !@domain.mx_status.nil?
    %p.pageContent__text.u-orange.u-bold
      %span.label.label--orange Warning
      = @domain.mx_error

  %p.pageContent__text
    If you wish to receive incoming e-mail for this domain, you need to add the following MX records
    to the domain. You don't have to do this and we'll only tell you if they're set up or not. Both
    records should be priority <b>10</b>.
  %pre.codeBlock.u-margin= Postal::Config.dns.mx_records.join("\n")

  - if @domain.mta_sts_enabled
    %h3.pageContent__subTitle MTA-STS
    - if @domain.mta_sts_status == 'OK'
      %p.pageContent__text.u-green.u-bold
        %span.label.label--green Good
        Your MTA-STS DNS record and policy file are accessible and valid!
    - elsif !@domain.mta_sts_status.nil?
      %p.pageContent__text.u-orange.u-bold
        %span.label.label--orange Warning
        = @domain.mta_sts_error

    %p.pageContent__text
      MTA-STS helps ensure that email sent to your domain is delivered over secure TLS connections.
      Add a TXT record at <b>#{@domain.mta_sts_record_name}</b> with the following content:
    %pre.codeBlock.u-margin= @domain.mta_sts_record_value

    %p.pageContent__text
      Additionally, you need to serve the MTA-STS policy file at:
    %pre.codeBlock.u-margin= @domain.mta_sts_policy_url

    %p.pageContent__text
      To do this, create an <b>A record</b> or <b>CNAME</b> for <b>mta-sts.#{@domain.name}</b> that points to your Postal installation.

    %p.pageContent__text
      You can verify the policy file is accessible by clicking the button below or visiting the URL directly:
    .u-margin.buttonSet
      = link_to "Test MTA-STS Policy File", [:check_mta_sts_policy, organization, @server, @domain], :remote => true, :method => :post, :class => 'button', :data => { confirm: false }
      = link_to "View Policy File", @domain.mta_sts_policy_url, :class => 'button button--neutral', :target => '_blank'

  - if @domain.tls_rpt_enabled
    %h3.pageContent__subTitle TLS-RPT (TLS Reporting)
    - if @domain.tls_rpt_status == 'OK'
      %p.pageContent__text.u-green.u-bold
        %span.label.label--green Good
        Your TLS-RPT record looks good!
    - elsif !@domain.tls_rpt_status.nil?
      %p.pageContent__text.u-orange.u-bold
        %span.label.label--orange Warning
        = @domain.tls_rpt_error

    %p.pageContent__text
      TLS-RPT allows you to receive reports about TLS connection issues from sending MTAs.
      Add a TXT record at <b>#{@domain.tls_rpt_record_name}</b> with the following content:
    %pre.codeBlock.u-margin= @domain.tls_rpt_record_value
